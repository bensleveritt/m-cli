#!/usr/bin/env bash

source "$( dirname "${BASH_SOURCE[0]}" )/../lib/defaults.sh"
source "$( dirname "${BASH_SOURCE[0]}" )/../lib/helpers.sh"

declare path_to_airport_binary="/System/Library/PrivateFrameworks/Apple80211.framework/Versions/A/Resources/airport"

help(){
    cat<<__EOF__
    usage: m airport [
                       disconnectonlogout   |
                       preferrednetworks    |
                       nonpreferrednetworks |
                       rememberrecents      |
                       secureadhocnetworks  |
                       securechangenetworks |
                       securetogglepower    |
                       help
                     ]

    Examples:
      m airport disconnectonlogout   [ YES | NO ]     #  whether to disconnect from wifi when logging out
      m airport rememberrecents      [ YES | NO ]     #  whether to remember recent networks

      m airport preferrednetworks    [                #  what to do when preferred networks are available
                                       Automatic |
                                       Preferred |
                                       Ranked    |
                                       Recent    |
                                       Strongest
                                     ]

      m airport nonpreferrednetworks [                #  how to join non-preferred networks if preferred
                                       Prompt      |  #  networks are unavailable
                                       JoinOpen    |
                                       KeepLooking |
                                       DoNothing
                                     ]

      m airport secureadhocnetworks  [ YES | NO ]     #  whether a password is required to create a
                                                      #  computer-to-computer network
      m airport securechangenetworks [ YES | NO ]     #  whether a password is required to change
                                                      #  networks
      m airport securetogglepower    [ YES | NO ]     #  whether a password is required to turn
                                                      #  wi-fi on or off
__EOF__
}

disconnectonlogout(){
    local choice="$(_mcli_yes_no_to_yes_no "$1")"

    sudo "${path_to_airport_binary}" prefs DisconnectOnLogout="${choice}"

    value="$(sudo "${path_to_airport_binary}" prefs DisconnectOnLogout)"

    echo "Airport disconnectonlogout: ${value}"
}

nonpreferrednetworks(){
    [ -n "$1" ] && sudo "${path_to_airport_binary}" prefs JoinModeFallback="$1"

    sudo "${path_to_airport_binary}" prefs JoinModeFallback
}

preferrednetworks(){
    [ -n "$1" ] && sudo "${path_to_airport_binary}" prefs JoinMode="$1"

    sudo "${path_to_airport_binary}" prefs JoinMode
}

rememberrecents(){
    local choice="$(_mcli_yes_no_to_yes_no "$1")"

    sudo "${path_to_airport_binary}" prefs RememberRecentNetworks="${choice}"

    value="$(sudo "${path_to_airport_binary}" prefs RememberRecentNetworks)"

    echo "Airport rememberrecents: ${value}"
}

secureadhocnetworks(){
    local choice="$(_mcli_yes_no_to_yes_no "$1")"

    sudo "${path_to_airport_binary}" prefs RequireAdminIBSS="${choice}"

    value="$(sudo "${path_to_airport_binary}" prefs RequireAdminIBSS)"

    echo "Airport secureadhocnetworks: ${value}"
}

securechangenetworks(){
    local choice="$(_mcli_yes_no_to_yes_no "$1")"

    sudo "${path_to_airport_binary}" prefs RequireAdminNetworkChange="${choice}"

    value="$(sudo "${path_to_airport_binary}" prefs RequireAdminNetworkChange)"

    echo "Airport securechangenetworks: ${value}"
}

securetogglepower(){
    local choice="$(_mcli_yes_no_to_yes_no "$1")"

    sudo "${path_to_airport_binary}" prefs RequireAdminPowerToggle="${choice}"

    value="$(sudo "${path_to_airport_binary}" prefs RequireAdminPowerToggle)"

    echo "Airport securetogglepower: ${value}"
}

case $1 in
    help)
        help
        ;;
    disconnectonlogout)
        shift
        disconnectonlogout $@
        ;;
    nonpreferrednetworks)
        shift
        preferrednetworks $@
        ;;
    preferrednetworks)
        shift
        preferrednetworks $@
        ;;
    rememberrecents)
        shift
        rememberrecents $@
        ;;
    secureadhocnetworks)
        shift
        secureadhocnetworks $@
        ;;
    securechangenetworks)
        shift
        securechangenetworks $@
        ;;
    securetogglepower)
        shift
        securetogglepower $@
        ;;
    *)
        help
        ;;
esac
